<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Dania</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #fdf6f0; /* Crema suave */
            --text-dark: #2b1b17; /* Café muy oscuro, casi negro */
            --heart-red: #c9182b; /* Rojo carmesí elegante */
            --heart-pink: #f2a2ab;
        }

        * { box-sizing: border-box; touch-action: none; margin: 0; padding: 0; }

        /* Fondo exterior (para cuando se vea en pantallas grandes) */
        body {
            background-color: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Playfair Display', serif;
            overflow: hidden;
        }

        /* --- MOBILE CONTAINER FORZADO --- */
        #mobile-container {
            width: 100vw;
            height: 100vh;
            max-width: 430px; /* Ancho máximo de un iPhone Pro Max */
            max-height: 932px;
            background-color: var(--bg-color);
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        /* --- SISTEMA DE PANTALLAS (WORKFLOW) --- */
        .screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 1.2s cubic-bezier(0.65, 0, 0.35, 1); /* Transición suave estilo Apple */
            background-color: var(--bg-color);
        }

        .screen-down { transform: translateY(100%); } /* Esperando abajo */
        .screen-active { transform: translateY(0); }   /* En pantalla */
        .screen-up { transform: translateY(-100%); }   /* Ya pasó (arriba) */

        /* --- PANTALLA 1: INICIO --- */
        .title-elegant {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--text-dark);
            text-align: center;
            line-height: 1.1;
            margin-bottom: 20px;
        }
        .title-elegant span { color: var(--heart-red); font-style: italic; }
        
        .start-btn {
            background: none; border: none; cursor: pointer;
            display: flex; flex-direction: column; align-items: center;
            margin-top: 30px; outline: none;
        }
        .start-heart {
            font-size: 45px; color: var(--heart-red);
            animation: pulse 1.2s infinite alternate;
        }
        .start-text {
            font-size: 1rem; color: #888;
            margin-top: 10px; font-style: italic;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.15); }
        }

        /* --- PANTALLA 2: ÁRBOL --- */
        canvas { display: block; width: 100%; height: 100%; }

        /* --- PANTALLA 3: MENSAJE --- */
        #msg-container { 
            width: 85%; 
            text-align: center; 
            padding: 20px;
            background: rgba(253, 246, 240, 0.7); /* Ligero fondo crema para resaltar el texto */
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(201, 24, 43, 0.05); /* Sombra roja muy sutil */
        }

        .msg-line {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1.5s ease, transform 1.5s ease;
        }

        .msg-line.visible { 
            opacity: 1; 
            transform: translateY(0); 
        }

        /* Formato específico para su nombre */
        .msg-name {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--heart-red);
            font-style: italic;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(201, 24, 43, 0.15);
        }

        /* Detalle romántico separador */
        .msg-divider {
            color: var(--heart-pink);
            font-size: 1.2rem;
            letter-spacing: 15px;
            margin-bottom: 25px;
        }

        /* Formato para los párrafos */
        .msg-text {
            font-size: 1.5rem;
            color: var(--text-dark);
            margin-bottom: 20px;
            line-height: 1.4;
        }

        /* Clase para destacar palabras clave dentro del texto */
        .msg-highlight {
            color: var(--heart-red);
            font-style: italic;
            font-weight: 600;
        }

        /* --- PANTALLA 4: CORAZÓN DANIA & VIDEO --- */
        #dania-heart-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin-bottom: 40px;
        }
        
        /* Partículas formadas por su nombre */
        .dania-particle {
            position: absolute;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--heart-red);
            opacity: 0;
            top: 50%; left: 50%; /* Nacen en el centro */
            transform: translate(-50%, -50%) scale(0.1);
            transition: all 2.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* El nombre central que brilla */
        .dania-center {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            font-style: italic;
            font-weight: 700;
            color: var(--heart-red);
            text-shadow: 0 0 20px rgba(201, 24, 43, 0.4);
            opacity: 0;
            transition: opacity 2s ease 2s; /* Aparece después de las partículas */
        }

        /* Animación de latido para todo el contenedor del corazón */
        .heart-beat { animation: heartbeat 2s infinite ease-in-out; }
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .action-btn {
            background-color: var(--heart-red);
            color: white;
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            font-style: italic;
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            box-shadow: 0 10px 20px rgba(201, 24, 43, 0.3);
            cursor: pointer;
            opacity: 0;
            transition: opacity 1s ease 3s, transform 0.2s;
        }
        .action-btn:active { transform: scale(0.95); }

        /* --- MODAL DEL VIDEO --- */
        #video-modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 10, 10, 0.95); z-index: 100;
            display: none; justify-content: center; align-items: center; flex-direction: column;
        }
        #video-modal video { width: 90%; max-height: 70vh; border-radius: 15px; box-shadow: 0 0 30px rgba(255,255,255,0.1); }
        .close-btn { color: white; font-size: 1.2rem; margin-top: 20px; cursor: pointer; border-bottom: 1px solid white; padding-bottom: 2px;}

    </style>
</head>
<body>

    <div id="mobile-container">
        
        <div id="screen-start" class="screen screen-active">
            <h1 class="title-elegant">De: Leo<br><span>Para: Dania</span></h1>
            <button class="start-btn" onclick="nextScreen()">
                <div class="start-heart">❤</div>
                <div class="start-text">Toca para comenzar</div>
            </button>
        </div>

        <div id="screen-tree" class="screen screen-down">
            <canvas id="tree-canvas"></canvas>
        </div>

        <div id="screen-message" class="screen screen-down">
            <div id="msg-container">
                <p class="msg-line msg-name">Dania,</p>
                
                <p class="msg-line msg-divider">Para recordarte que no estas sola</p>
                
                <p class="msg-line msg-text">Desde <span class="msg-highlight">lejos</span> quiero que sepas lo mucho que te quiero.</p>
                
                <p class="msg-line msg-text">Gracias por <span class="msg-highlight">estar conmigo</span> </p>
            </div>
        </div>

        <div id="screen-dania" class="screen screen-down">
            <div id="dania-heart-container">
                <div id="dania-name-center" class="dania-center">Dania</div>
            </div>
            <button id="video-btn" class="action-btn" onclick="openVideo()">Mi persona especial</button>
        </div>

        <div id="video-modal">
            <video id="my-video" controls playsinline>
                <source src="mivideo.mp4" type="video/mp4">
            </video>
            <div class="close-btn" onclick="closeVideo()">Cerrar video</div>
        </div>

    </div>

    <script>
        // --- CONTROLADOR DE FLUJO (WORKFLOW) ---
        let currentScreen = 0;
        const screens = ['screen-start', 'screen-tree', 'screen-message', 'screen-dania'];

        function nextScreen() {
            if (currentScreen >= screens.length - 1) return;
            
            // La pantalla actual sube y desaparece
            document.getElementById(screens[currentScreen]).className = 'screen screen-up';
            currentScreen++;
            // La nueva pantalla sube desde abajo y se vuelve activa
            document.getElementById(screens[currentScreen]).className = 'screen screen-active';

            // Ejecutar la animación correspondiente a la nueva pantalla
            if(currentScreen === 1) setTimeout(initTreeMagic, 600); // Da tiempo a la transición CSS
            if(currentScreen === 2) setTimeout(showMessages, 800);
            if(currentScreen === 3) setTimeout(animateDaniaHeart, 800);
        }

        // --- PANTALLA 2: LÓGICA DEL ÁRBOL ---
        const canvas = document.getElementById('tree-canvas');
        const ctx = canvas.getContext('2d');
        let w, h, dpr, groundY, scale, treeTimer;
        let branches = [];
        let leaves = [];

        function resizeCanvas() {
            const container = document.getElementById('mobile-container');
            w = container.clientWidth;
            h = container.clientHeight;
            dpr = window.devicePixelRatio || 1;
            canvas.width = w * dpr;
            canvas.height = h * dpr;
            ctx.scale(dpr, dpr);
            groundY = h * 0.8; 
            scale = Math.min(w, h) / 400; 
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function initTreeMagic() {
            ctx.clearRect(0, 0, w, h);
            
            // Dibujar el suelo
            ctx.beginPath();
            ctx.moveTo(0, groundY);
            ctx.lineTo(w, groundY);
            ctx.strokeStyle = '#2b1b17';
            ctx.lineWidth = 1;
            ctx.stroke();

            // Caída de semilla
            let seedY = 0;
            function dropSeed() {
                ctx.clearRect(0, 0, w, groundY - 2); 
                ctx.beginPath();
                ctx.arc(w/2, seedY, 4 * scale, 0, Math.PI * 2);
                ctx.fillStyle = '#c9182b';
                ctx.fill();
                
                seedY += 8 * scale; 
                if (seedY < groundY) {
                    requestAnimationFrame(dropSeed);
                } else {
                    ctx.clearRect(0, 0, w, groundY - 2); 
                    startTree();
                }
            }
            dropSeed();
        }

        function startTree() {
            branches = [];
            buildTree(w/2, groundY, -Math.PI/2, h * 0.12, 6, 7 * scale);
            drawNextBranch();
        }

        function buildTree(x, y, angle, length, depth, width) {
            if (depth === 0) return;
            let endX = x + Math.cos(angle) * length;
            let endY = y + Math.sin(angle) * length;
            branches.push({x, y, endX, endY, width});
            buildTree(endX, endY, angle - 0.45, length * 0.75, depth - 1, width * 0.65);
            buildTree(endX, endY, angle + 0.45, length * 0.75, depth - 1, width * 0.65);
        }

        let branchIndex = 0;
        function drawNextBranch() {
            if (branchIndex < branches.length) {
                let b = branches[branchIndex];
                ctx.beginPath(); ctx.moveTo(b.x, b.y); ctx.lineTo(b.endX, b.endY);
                ctx.strokeStyle = '#5c4033'; ctx.lineWidth = b.width; ctx.lineCap = 'round'; ctx.stroke();
                branchIndex++;
                requestAnimationFrame(drawNextBranch); 
            } else {
                generateLeaves();
            }
        }

        function generateLeaves() {
            let targetLeaves = 200;
            let heartCenterY = groundY - (h * 0.3); 
            let heartRadius = w * 0.35; 

            while(leaves.length < targetLeaves) {
                let rx = (Math.random() - 0.5) * 3;
                let ry = (Math.random() - 0.5) * 3;
                if (Math.pow(rx*rx + ry*ry - 1, 3) - rx*rx * Math.pow(ry, 3) <= 0) {
                    leaves.push({
                        x: (w/2) + (rx * heartRadius), y: heartCenterY - (ry * heartRadius),
                        size: (Math.random() * 4 + 3) * scale,
                        color: Math.random() > 0.5 ? '#c9182b' : '#f2a2ab',
                        delay: Math.random() * 1500 
                    });
                }
            }
            let startTime = Date.now();
            function renderLeaves() {
                let timePassed = Date.now() - startTime;
                let allDrawn = true;
                leaves.forEach(leaf => {
                    if (timePassed > leaf.delay && !leaf.drawn) {
                        ctx.save(); ctx.translate(leaf.x, leaf.y); ctx.fillStyle = leaf.color;
                        ctx.beginPath(); ctx.moveTo(0, 0);
                        ctx.bezierCurveTo(-leaf.size, -leaf.size, -leaf.size * 2, leaf.size / 3, 0, leaf.size);
                        ctx.bezierCurveTo(leaf.size * 2, leaf.size / 3, leaf.size, -leaf.size, 0, 0);
                        ctx.fill(); ctx.restore();
                        leaf.drawn = true;
                    }
                    if (!leaf.drawn) allDrawn = false;
                });

                if (!allDrawn) {
                    requestAnimationFrame(renderLeaves);
                } else {
                    // Terminó el árbol, esperamos 2.5 seg y pasamos a la siguiente pantalla solos
                    setTimeout(nextScreen, 2500);
                }
            }
            renderLeaves();
        }

        // --- PANTALLA 3: LÓGICA DEL MENSAJE ---
        function showMessages() {
            const lines = document.querySelectorAll('.msg-line');
            lines.forEach((line, index) => {
                setTimeout(() => {
                    line.classList.add('visible');
                }, index * 2000); // 2 segundos por línea
            });

            // Pasar a la siguiente pantalla automáticamente
            setTimeout(nextScreen, lines.length * 2000 + 2000);
        }

        // --- PANTALLA 4: CORAZÓN HECHO CON "DANIA" ---
        function animateDaniaHeart() {
            const container = document.getElementById('dania-heart-container');
            const nameLetters = ['D', 'a', 'n', 'i', 'a'];
            const totalParticles = 75; // Cantidad de letras formando el contorno
            const scaleSize = 10; // Tamaño del corazón formado

            for(let i = 0; i < totalParticles; i++) {
                // Generar puntos a lo largo de la ecuación del corazón
                let t = (i / totalParticles) * Math.PI * 2;
                // Fórmulas matemáticas del corazón
                let x = 16 * Math.pow(Math.sin(t), 3);
                let y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));

                let finalX = x * scaleSize;
                let finalY = y * scaleSize;

                let span = document.createElement('span');
                // Asignar letra secuencial (D-a-n-i-a-D-a-n-i-a...)
                span.innerText = nameLetters[i % nameLetters.length];
                span.className = 'dania-particle';
                
                // Variar opacidad y tamaño para darle textura
                span.style.opacity = Math.random() * 0.5 + 0.5;
                span.style.fontSize = (Math.random() * 0.6 + 0.8) + 'rem';
                
                container.appendChild(span);

                // Forzar un reflujo (reflow) en CSS para que la animación funcione
                void span.offsetWidth; 

                // Mover del centro a su posición formando el corazón
                setTimeout(() => {
                    span.style.transform = `translate(calc(-50% + ${finalX}px), calc(-50% + ${finalY}px)) scale(1)`;
                    span.style.opacity = "1";
                }, i * 20); // Van saliendo una por una rápido
            }

            // Hacer visible el "Dania" gigante central y el botón
            document.getElementById('dania-name-center').style.opacity = "1";
            document.getElementById('video-btn').style.opacity = "1";
            
            // Añadir el latido a todo el contenedor después de armarse
            setTimeout(() => {
                container.classList.add('heart-beat');
            }, 2500);
        }

        // --- LÓGICA DEL VIDEO ---
        function openVideo() {
            document.getElementById('video-modal').style.display = 'flex';
            document.getElementById('my-video').play();
        }

        function closeVideo() {
            document.getElementById('video-modal').style.display = 'none';
            document.getElementById('my-video').pause();
            document.getElementById('my-video').currentTime = 0;
        }
    </script>
</body>
</html>